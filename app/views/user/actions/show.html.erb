<div class="container">
    <div class="row">
    <div class="page_title">
    <%# デート予約前の場合 %>
    <% if @action.matching_date == nil %>
        <h2>デート予約</h2>
        <p>女性がデート場所を選択してください</p>
    <%# デート開催待ちの場合 %>
    <% elsif @action.matching_date >= Date.today %>
        <h2>デート待ち</h2>
    <% else %>
    <% end %>
    </div>
        <div class="col-sm-offset-2 col-sm-8">
        <table class="table table-border-less">
            <tr>
                <td class="col-sm-4">
                    <div class="user_image">
                        <%= link_to (user_path(@action.male_user.id)) do %>
                            <%= attachment_image_tag @action.male_user, :user_image, :fill, 250, 350, fallback: "no_image.jpg", size:'250x350' %>
                        <% end %>
                    </div>
                </td>
                <td class="col-sm-4">
                    <div class="user_image">
                        <%= link_to (user_path(@action.female_user.id)) do %>
                            <%= attachment_image_tag @action.female_user, :user_image, :fill, 250, 350, fallback: "no_image.jpg", size:'250x350' %>
                        <% end %>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="date_show_male_name">
                        <%= @action.male_user.name %>
                    </div>
                </td>
                <td>
                    <div class="date_show_female_name">
                        <%= @action.female_user.name %>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="date_show_profile">
                        <% birthdate = @action.male_user.birth_date%>
                        <%= (Date.today.strftime("%Y%m%d").to_i - birthdate.strftime("%Y%m%d").to_i) / 10000 %>歳
                        <%= @action.male_user.prefecture_cd %>
                    </div>
                </td>
                <td>
                    <div class="date_show_profile">
                        <% birthdate = @action.female_user.birth_date%>
                        <%= (Date.today.strftime("%Y%m%d").to_i - birthdate.strftime("%Y%m%d").to_i) / 10000 %>歳
                        <%= @action.female_user.prefecture_cd %>
                    </div>
                </td>
            <tr>
        </table>
        </div>
        <div class="col-sm-offset-2 col-sm-8">
        <table class="table table-border-less">
            <tr>
                <th class="col-sm-2">日時</th>
                <td class="col-sm-10">
                <%# デート予約前の場合 %>
                <% if @action.matching_date == nil %>
                    <% @male_schedules.each do |male_schedule| %>
                        <% @female_schedules.each do |female_schedule| %>
                            <% if male_schedule.user_schedule_date == female_schedule.user_schedule_date && male_schedule.user_schedule_time_cd == female_schedule.user_schedule_time_cd %>
                                <%= male_schedule.user_schedule_date.strftime('%Y年%m月%d日') %><%= male_schedule.user_schedule_time_cd %>
                            <% end %>
                        <% end %>
                    <% end %>
                <%# デート開催待ちの場合 %>
                <% elsif @action.matching_date >= Date.today %>
                    <%= @action.matching_date.strftime('%Y年%m月%d日') %><%= @action.matching_time_cd %>
                <% else %>
                <% end %>
                </td>
            </tr>
            <tr>
                <th>場所</th>
                <td>
        <%# デート予約前の場合 %>
        <% if @action.matching_date == nil %>
                    <%= form_for(@action, url: action_path(@action.id)) do |f| %>
                        <%= f.collection_select :shop_id, @shops, :id, :shop_name %>
                </td>
            </tr>
        </table>
            <div class="date_show_btn">
                <%= f.submit "デートを予約する", class:"btn btn-primary" %>
            <% end %>
            </div>
        <%# デート開催待ちの場合 %>
        <% elsif @action.matching_date >= Date.today %>
                    <%= @action.shop.shop_name %>
                </td>
            </tr>
            <tr>
                <th>アクセス</th>
                <td><%= @action.shop.prefecture_cd %><%= @action.shop.city %><%= @action.shop.building %></td>
            </tr>
            <tr>
                <th></th>
                <td><%= attachment_image_tag @action.shop, :shop_image, :fill, 500, 300, fallback: "no_image.jpg", size:'500x300' %></td>
            </tr>
        </table>
            <div class="date_show_info">
                <p>※デート開催日の前日まで変更・キャンセル可能です。</p>
            </div>
            <div class="date_show_btn">
                <% if current_user.gender_cd == "男性" %>
                    <%= link_to '編集する', edit_action_path(@action.female_user.id), class:"btn btn-primary" %>
                <% else %>
                    <%= link_to '編集する', edit_action_path(@action.male_user.id), class:"btn btn-primary" %>
                <% end %>
            </div>
        <% else %>
        <% end %>
        </div>
    </div>
</div>